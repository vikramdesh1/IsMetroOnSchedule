<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  <title>Is Metro On Schedule?</title>
  
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.0/jquery.min.js"></script>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
  
  <script>
    
  $(document).ready(function() {
    $("#header").fadeIn(1000, function(){
      $.ajax({
      url: "https://api.wmata.com/Incidents.svc/json/Incidents",
      beforeSend: function(xhrObj) {
        xhrObj.setRequestHeader("api_key", "affa4c8afe0f49aaaa0e588b26cfc4aa");
      },
      type: "GET"
      })
    .done(function(data) {
      console.log(data.Incidents);
      if (data.Incidents.length > 0) {
        
        for(i=0; i<data.Incidents.length; i++) {
        var incident = data.Incidents[i];
        var detail = "<br/> <div id=\"detail" + i +"\"" + ">"
        + "<br/><strong>Incident Type : </strong>" + incident.IncidentType
        + "<br/><strong>Lines Affected : </strong>" + incident.LinesAffected
        + "<br/><strong>Description : </strong>" + incident.Description
        + "</div>";
        $('#details').append(detail);
        }
        var message = "No, there are currently " + data.Incidents.length + " issue(s) on Metro.";
        updateStatusText(message);
        
        
      } else {
        updateStatusText("Yes, all trains appear to be running on time.");
      }
      })
    .fail(function() {
      console.log("Something went wrong...");
      updateStatusText("A problem occured while checking for incidents. Please try again later.");
      });
    });
});

function updateStatusText(text) {
    $('#test').fadeOut(function(){
    $('#test').text(text);
    $('#test').fadeIn(function() {
      showDetails();
    });
  });
      
};

function showDetails() {
  $('#details').slideDown();
}

    
  </script>
  
</head>

<body>

<div id="header" class="container-fluid jumbotron" style="display:none">
  <h1 class="text-center">Is Metro on schedule?</h1>
  <div id='test' class="text-center"><p>Checking...</p></div>
</div>

<div id="details" class="container-fluid text-center" style="display:none">

</div>
</body>

</html>
